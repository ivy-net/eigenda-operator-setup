<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<filter eigenda-native-node>
  @type record_transformer
  enable_ruby
  <record>
    log_level "${\
    log = record['log']
      if log =~ /ERR/
        'ERROR'
      elsif log =~ /WRN/
        'WARN'
      elsif log =~ /INF/
        'INFO'
      elsif log =~ /DBG/
        'DEBUG'
      else
        'UNKNOWN'
      end
    }"
  </record>
</filter>

<match **>
  @type file
  path /var/log/fluentd/${tag}/%Y-%m-%d
  append true
  <buffer tag,time>
    @type file
    timekey 1d
    timekey_use_utc true
    timekey_wait 10m
    flush_mode interval
    flush_interval 5s
  </buffer>
  <format>
    @type json
  </format>
</match>
